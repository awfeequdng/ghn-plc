/* -*- Mode:C++; c-file-style:"gnu"; indent-tabs-mode:nil; -*- */
/*
 * Copyright (c) 2012 University of British Columbia, Vancouver
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 as
 * published by the Free Software Foundation;
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 *
 * Author: Alexander Schloegl <alexander.schloegl@gmx.de>
 */

#ifndef PLC_DCMC_CAPACITIES_H_
#define PLC_DCMC_CAPACITIES_H_

#include <ns3/spectrum-value.h>
#include <ns3/plc-defs.h>

namespace ns3 {

/*
 * Mutual information in bits/channel use for equally probable input symbols on a discrete input continuous output memoryless channel (DCMC)
 * with additive white gaussian noise for SNR (Es/N0) range [-10:1:40]dB
 */

enum Modulation
{
	QAM,
	PSK
};

// QAM signal constellations
static const double qamCap[12][51] = {
		// BPSK
		{0.13142,0.16177,0.19814,0.24123,0.29159,0.34951,0.41482,0.48671,0.56359,0.643,0.72154,0.79505,0.85953,0.91242,0.95138,0.97584,0.99032,0.99687,0.99914,0.99987,0.99998,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
		// 4-QAM
		{0.137485587352943,0.171029115645443,0.212154614299730,0.262263576689166,0.322858245007343,0.395462746276877,0.481494410876594,0.582072625063591,0.697757528083859,0.828222684755073,0.971888188321684,1.12557617466220,1.28429720533650,1.44132170295442,1.58870676785386,1.71838810882445,1.82376085661318,1.90136216578748,1.95195990409749,1.98032714316540,1.99351261704897,1.99836850112301,1.99970779721149,1.99996578967525,1.99999762502502,1.99999988570842,1.99999996655534,1.99999996764080,1.99999996934884,1.99999997066748,1.99999997190523,1.99999997288924,1.99999997384197,1.99999997449997,1.99999997522377,1.99999997577509,1.99999997629895,1.99999997670667,1.99999997715144,1.99999997748763,1.99999997780765,1.99999997807690,1.99999997819978,1.99999997826869,1.99999997821250,1.99999997805364,1.99999998377958,2.00000020577215,2.00002668745310,2.00000739790573,2.00307298485379},
		// 8-QAM
		{0.137489856122530,0.171039099792896,0.212177581437683,0.262315660442069,0.322974305213429,0.395716614748578,0.482038502824638,0.583213033167505,0.700090617747385,0.832871835094772,0.980890931438499,1.14247256327243,1.31494053489097,1.49484469727886,1.67840655407391,1.86205753721949,2.04280092848761,2.21809006976777,2.38513219090812,2.54000719432322,2.67740945455387,2.79164721854673,2.87865389167967,2.93788851485883,2.97293694759505,2.99035611276317,2.99732750387331,2.99945947212720,2.99992632884568,2.99999386868564,2.99999971082589,2.99999997783316,2.99999998317580,2.99999998394401,2.99999998493853,2.99999998560830,2.99999998627819,2.99999998676968,2.99999998728357,2.99999998754014,2.99999998783842,2.99999998803008,2.99999998823866,2.99999998834965,2.99999998831873,2.99999998832706,2.99999999077164,2.99999997954461,3.00002240444529,2.99981631954092,3.00222843204662},
		// 16-QAM
		{0.137485226024525,0.171042822430042,0.212197367554635,0.262369201868168,0.323099554346774,0.395992904625563,0.482626391926246,0.584426489126985,0.702521435398811,0.837589577622119,0.989740096582826,1.15846732762828,1.34271090234206,1.54101535376192,1.75173081552389,1.97316687918858,2.20363315210573,2.44130328763109,2.68373573299057,2.92688195634139,3.16394300647222,3.38516442418005,3.57940554882864,3.73705607640717,3.85302371655245,3.92853161979712,3.97079133014973,3.99039203075380,3.99759123682333,3.99957026995003,3.99994993101001,3.99999653224777,3.99999981168082,3.99999991466017,3.99999991762097,3.99999992757468,3.99999993817169,3.99999994508215,3.99999995072742,3.99999995510463,3.99999995971070,3.99999996185201,3.99999996554178,3.99999996650110,3.99999996750933,3.99999996867733,3.99999996857697,3.99999999448776,3.99999595641935,4.00000583215574,4.00032099414529},
		// 32-QAM
		{0.137476209578422,0.171037994523173,0.212199129561469,0.262382986361738,0.323137388105121,0.396079761617617,0.482812050191013,0.584805476240419,0.703264910220367,0.838991383573111,0.992273952938900,1.16284549329593,1.34992444863918,1.55233703575154,1.76867880692986,1.99745941425090,2.23719460328664,2.48644303191467,2.74380168769839,3.00785641588858,3.27701739307807,3.54901879593527,3.81984063257820,4.08241594905696,4.32637632951443,4.53981767135775,4.71255440248202,4.83936211414685,4.92184579577909,4.96801554224427,4.98945609977778,4.99734867518414,4.99952515819289,4.99994440011966,4.99999610645052,4.99999975625006,4.99999984433507,4.99999986617144,4.99999989108037,4.99999991185921,4.99999992634389,4.99999993741792,4.99999994653229,4.99999995706619,4.99999996099252,4.99999996782468,4.99999984173641,5.00001748822751,5.00001305197267,5.00002335548177,4.99946640387005},
		// 64-QAM
		{0.137452711037323,0.171018691245912,0.212182253899847,0.262367159306260,0.323119656033471,0.396054968857671,0.482770263839225,0.584727923089975,0.703117288435616,0.838713441090931,0.991766622390619,1.16195722299683,1.34844399943024,1.55000204263359,1.76520820605011,1.99261149877210,2.23083900321560,2.47863616133864,2.73486568704764,2.99849381484756,3.26857141751698,3.54421384080927,3.82456748523184,4.10871172974793,4.39527977294209,4.68143255049579,4.96127850769498,5.22499043261897,5.46007791868174,5.65470262163089,5.80146161694426,5.90000195250586,5.95729708136475,5.98516071786180,5.99601513135161,5.99922516242764,5.99989944512515,5.99999201883427,5.99999948390875,5.99999971445690,5.99999973356699,5.99999978205062,5.99999984743170,5.99999985357637,5.99999989454455,5.99999990247379,5.99999987515407,5.99999602106915,6.00001209919286,5.99996853421067,6.00014027351671},
		// 128-QAM
		{0.137411286717295,0.170986848897412,0.212159745443158,0.262354895932136,0.323124020445217,0.396087804405136,0.482857637252268,0.584918340756133,0.703499370920394,0.839439081541789,0.993079276441248,1.16422023174198,1.35215821665543,1.55579801066783,1.77380974454961,2.00477606124241,2.24729404813156,2.50003108405774,2.76174596032471,3.03129299544987,3.30761917233631,3.58975751396024,3.87682387825177,4.16801493062665,4.46260592361629,4.75993741374168,5.05931916790230,5.35959839433499,5.65798785632614,5.94834325860363,6.22034359145136,6.46106275730986,6.65859652818619,6.80597186117705,6.90366214087129,6.95958183656448,6.98626035224689,6.99641038522624,6.99932606357457,6.99991605462152,6.99999352552554,6.99999935545374,6.99999934370895,6.99999947651125,6.99999966882008,6.99999969860951,6.99999943902702,6.99999813483398,7.00002115322413,7.00005063363599,6.99899948570781},
		// 256-QAM
		{0.137316969089923,0.170909798698286,0.212095774568770,0.262299211764104,0.323069380098760,0.396024009893683,0.482765372976409,0.584763942261688,0.703221937597466,0.838935424910886,0.992183560948504,1.16268415085172,1.34963991821619,1.55186909612110,1.76798765076885,1.99657660537484,2.23629258538141,2.48591444798499,2.74434545621621,3.01060548748592,3.28381863587031,3.56319866239627,3.84804065031800,4.13771107776073,4.43163705176688,4.72929750850899,5.03021588964321,5.33394739343087,5.64006336288584,5.94807867254190,6.25711562700455,6.56486453667828,6.86582624695881,7.15013351994053,7.40469135286472,7.61668288466329,7.77772864137577,7.88686268938599,7.95104674986413,7.98270682621580,7.99526038159696,7.99905352654288,7.99987301512501,7.99998915593208,7.99999872490469,7.99999873654387,7.99999883372647,8.00000037370979,7.99999010422742,8.00007507456930,7.99935037327290},
		// 512-QAM
		{0.137149134460321,0.170774558123265,0.211988551960214,0.262218977375511,0.323014469515782,0.396004496620003,0.482798901645394,0.584887792360348,0.703507058891104,0.839504848998271,0.993233781529783,1.16451138403600,1.35265020709664,1.55657239481251,1.77496388854762,2.00642084770322,2.24955285433468,2.50304227357222,2.76566589199566,3.03630466098458,3.31393929140315,3.59765022394570,3.88661707031665,4.18011465975379,4.47751785453253,4.77829702469100,5.08201434584548,5.38830722284888,5.69687200735387,6.00743883715555,6.31975528920634,6.63356140449270,6.94851181532780,7.26377864803936,7.57689088302154,7.88189928529541,8.16835520239317,8.42280705083611,8.63257526595761,8.78994354886005,8.89494644073376,8.95552687412681,8.98476265095769,8.99594930679391,8.99922471779662,8.99990132434304,8.99999159260221,8.99999496652017,9.00000358274016,8.99997193349209,9.00003635185229},
		// 1024-QAM
		{0.136777219058651,0.170469417128457,0.211740390315040,0.262014654891255,0.322836762220970,0.395837743951859,0.482619397147413,0.584654203662598,0.703149868284820,0.838909623406359,0.992216955306125,1.16280471504283,1.34988216183098,1.55227799199557,1.76862078663422,1.99749542722198,2.23756701744238,2.48761703410199,2.74655968406390,3.01342039596605,3.28733401305369,3.56752546904968,3.85330474970673,4.14405765443919,4.43923148534379,4.73833622913648,5.04092927285671,5.34661923629472,5.65505248905738,5.96590803382683,6.27890129686527,6.59376939964203,6.91027509711279,7.22819373361768,7.54731055464954,7.86735587819230,8.18769248590815,8.50627610067905,8.81780639486245,9.11241393595399,9.37671601018619,9.59741914235856,9.76566095650196,9.88017680337180,9.94793735323623,9.98143640171959,9.99484407325671,9.99897052527686,9.99984172986649,10.0000302789237,9.99997958984088},
		// 2048-QAM
		{0.136089455746102,0.169923466423359,0.211304775654984,0.261656698390915,0.322565882018925,0.395639747649069,0.482503434270946,0.584651964556782,0.703322299597758,0.839364918398790,0.993144309351052,1.16447852519486,1.35268351493540,1.55668981940129,1.77518519261856,2.00677075299161,2.25006042314642,2.50373809551633,2.76658541842715,3.03748855463755,3.31543409858213,3.59951069298266,3.88891151912976,4.18292176662951,4.48092858408527,4.78241961839858,5.08696819331847,5.39422660981248,5.70391125723902,6.01577957851708,6.32961182020640,6.64521486438499,6.96240276652500,7.28100765209338,7.60086606280262,7.92182919281476,8.24375021167736,8.56648044546094,8.88980292205639,9.21303899697025,9.53390210763483,9.84657202694546,10.1405779999838,10.4021971757926,10.6190206652250,10.7813325339434,10.8900663512130,10.9531841787555,10.9838886838446,10.9957244514090,10.9998035122138},
		// 4096-QAM
		{0.134595479803284,0.168703090789386,0.210315069702162,0.260852162811535,0.321902096474105,0.395077886319637,0.481999958261177,0.584147892762603,0.702741098439057,0.838576508972077,0.991959244120780,1.16261460654819,1.34975972494222,1.55222445602260,1.76864826030397,1.99761632459135,2.23779031938941,2.48796215610661,2.74704258153862,3.01406079255034,3.28814407367181,3.56853985101589,3.85455218329611,4.14556739464038,4.44104032539728,4.74048259349064,5.04345682812586,5.34958308484666,5.65850260946404,5.96992477084459,6.28355960300800,6.59916890733065,6.91652141346339,7.23543020049957,7.55571050419609,7.87721092437560,8.19977944602105,8.52329246631656,8.84762365261517,9.17266063030234,9.49830456782578,9.82438230323004,10.1503921209726,10.4744259271397,10.7913431035986,11.0914100168233,11.3619129188504,11.5854192505951,11.7592210286160,11.8752840482191,11.9465859509858}

};

// PSK signal constellations
static const double pskCap[3][51] = {
		// 16-PSK
		{0.13749,0.17104,0.21218,0.26232,0.32297,0.39572,0.48204,0.58321,0.70009,0.83287,0.98089,1.1425,1.315,1.4949,1.6787,1.8629,2.0452,2.2245,2.4007,2.5743,2.7459,2.9161,3.0848,3.2509,3.4118,3.5624,3.696,3.8063,3.8893,3.9444,3.9764,3.992,3.9978,3.9996,3.9999,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4},
		// 32-PSK
		{0.13749,0.17104,0.21218,0.26232,0.32298,0.39572,0.48204,0.58321,0.70009,0.83287,0.98089,1.1425,1.315,1.4949,1.6787,1.8629,2.0452,2.2245,2.4007,2.5743,2.746,2.9163,3.0857,3.2543,3.4224,3.59,3.7573,3.9243,4.0907,4.2554,4.4155,4.5655,4.6986,4.8083,4.8908,4.9453,4.9769,4.9922,4.9979,4.9996,4.9999,5,5,5,5,5,5,5,5,5,5},
		// 64-PSK
		{0.13749,0.17104,0.21218,0.26232,0.32298,0.39572,0.48204,0.58321,0.70009,0.83287,0.98089,1.1425,1.315,1.4949,1.6787,1.8629,2.0452,2.2245,2.4007,2.5743,2.746,2.9163,3.0857,3.2543,3.4224,3.59,3.7573,3.9244,4.0912,4.2579,4.4245,4.591,4.7574,4.9237,5.0896,5.254,5.4139,5.5641,5.6973,5.8074,5.8901,5.9449,5.9766,5.9921,5.9978,5.9996,5.9999,6,6,6,6}
};

SpectrumValue GetCapacity(const SpectrumValue& SINR_dB, Modulation mod, short cardinality);
//tsokalo
SpectrumValue GetCapacity(const SpectrumValue& SINR_dB, BitAllocationTable bat);
double GetCapPerChannel(double sinr_db, ModulationType m);

} // namespace ns3

#endif /* PLC_DCMC_CAPACITIES_H_ */
